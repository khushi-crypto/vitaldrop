<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VitalDrop | Nearby Camps</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=2">
</head>
<body>

<header class="nav">
  <div class="brand">
    <div class="logo">VD</div>
    <div>
      <div class="name">VitalDrop</div>
      <div class="tag">Nearby Blood Camps</div>
    </div>
  </div>

  <nav class="links">
    <a href="/">Home</a>
    <a href="/register">Register</a>
    <a href="/dashboard">Dashboard</a>
    <a class="active" href="/nearby-camps">Nearby Camps</a>
  </nav>

  <a class="btn ghost" href="/dashboard">Back</a>
</header>


<section class="section">

  <!-- üîé SEARCH FORM -->
  <div class="form-card" style="margin-bottom: 25px;">
    <h2>Find Nearby Blood Camps</h2>
    <p class="muted-text">Search by city or area to contact real blood support centers.</p>

    <form method="POST" class="form">
      <div class="grid2">

        <div>
          <label>City *</label>
          <input name="city" type="text" placeholder="e.g., Ghaziabad or Muradnagar" value="{{ city }}" required>
        </div>

        <div>
          <label>Area (optional)</label>
          <input name="area" type="text" placeholder="e.g., Indirapuram" value="{{ area }}">
        </div>

      </div>

      <button class="btn primary full" type="submit">
        üîç Search Camps
      </button>
    </form>
  </div>


  <!-- ‚ö†Ô∏è FLASH MESSAGE -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <p class="muted-text">{{ messages[0] }}</p>
    {% endif %}
  {% endwith %}


  <!-- üìã CAMPS TABLE -->
  {% if camps %}
  <div class="table-card">
    <h2>Available Blood Camps</h2>
    <p class="muted-text">Use Call, WhatsApp, or Email to contact directly.</p>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Camp Name</th>
            <th>Area</th>
            <th>Phone</th>
            <th>Contact</th>
            <th>Map</th>
          </tr>
        </thead>

        <tbody>
          {% for c in camps %}
          <tr>

            <!-- Camp Name -->
            <td>
              {{ c.camp_name }}
              {% if c.active_status == 1 %}
                <span class="pill2">Verified</span>
              {% endif %}
            </td>

            <!-- Area -->
            <td>{{ c.area or "-" }}</td>

            <!-- Phone -->
            <td>{{ c.phone }}</td>

            <!-- CONTACT BUTTONS -->
            <td style="display:flex; gap:6px; flex-wrap:wrap;">

              {% if c.tel_link %}
              <a class="btn small ghost" href="{{ c.tel_link }}">Call</a>
              {% endif %}

              {% if c.wa_link %}
              <a class="btn small ghost" target="_blank" href="{{ c.wa_link }}">WhatsApp</a>
              {% endif %}

              {% if c.mail_link %}
              <a class="btn small ghost" href="{{ c.mail_link }}">Email</a>
              {% endif %}

            </td>

            <!-- VIEW MAP BUTTON -->
            <td>
              <form method="POST" action="/nearby-camps#map">
                <input type="hidden" name="city" value="{{ city }}">
                <input type="hidden" name="area" value="{{ area }}">
                <input type="hidden" name="selected_camp_id" value="{{ c.id }}">
                <button class="btn small primary" type="submit">
                  View Map
                </button>
              </form>
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}


  <!-- üó∫Ô∏è MAP PREVIEW SECTION -->
  {% if selected_map_embed %}
  <div id="map" class="table-card" style="margin-top: 25px;">
    <h2>Location Preview ‚Äî {{ selected_camp_name }}</h2>

    <iframe
      src="{{ selected_map_embed }}"
      width="100%"
      height="420"
      style="border:0; border-radius:12px;"
      loading="lazy">
    </iframe>
  </div>
  {% endif %}

</section>

</body>
</html>

